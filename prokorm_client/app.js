!function(){"use strict";angular.module("auth",[]),angular.module("feed",[]),angular.module("profile",[]),angular.module("catalog",[]),angular.module("info",[]),angular.module("help",[]),angular.module("admin",[]),angular.module("prokorm",["ngResource","ui.router","ngMaterial","ngMdIcons","ui.carousel","catalog","profile","feed","auth","help","info","admin"]),angular.module("prokorm").constant("_",window._),angular.module("prokorm").config(["$mdDateLocaleProvider",function($mdDateLocaleProvider){$mdDateLocaleProvider.formatDate=function(date){return moment(date).format("DD-MM-YYYY")}}]),angular.module("prokorm").config(["$httpProvider",function($httpProvider){function isAPIrequest(url){return/^\/?api\//.test(url)}function convertDateStringsToDates(input){if("object"!=typeof input)return input;for(var key in input)if(input.hasOwnProperty(key)){var match,value=input[key];if("string"==typeof value&&(match=value.match(regexIso8601))){var milliseconds=Date.parse(match[0]);isNaN(milliseconds)||(input[key]=new Date(milliseconds))}else"object"==typeof value&&convertDateStringsToDates(value)}}var dialog;$httpProvider.defaults.headers.get||($httpProvider.defaults.headers.get={}),$httpProvider.defaults.headers.get["If-Modified-Since"]="Mon, 26 Jul 1997 05:00:00 GMT",$httpProvider.defaults.headers.get["Cache-Control"]="no-cache",$httpProvider.defaults.headers.get.Pragma="no-cache";$httpProvider.interceptors.push(function($q,$injector){return{request:function(config){return config},requestError:function(rejection){return $q.reject(rejection)},response:function(response){return isAPIrequest(response.config.url)?response.data:response},responseError:function(rejection){return 401===rejection.status&&$injector.get("$state").transitionTo("login"),isAPIrequest(rejection.config.url)?(dialog=dialog||$injector.get("$mdDialog"),401!==rejection.status&&rejection.data.message&&dialog.show(dialog.alert().clickOutsideToClose(!1).title("Ошибка").textContent(rejection.data.message).ok("Закрыть")),$q.reject(rejection.data)):$q.reject(rejection)}}});var regexIso8601=/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d\d):?(\d\d))?$/;$httpProvider.defaults.transformResponse.push(function(responseData){return convertDateStringsToDates(responseData),responseData})}])}(),function(){"use strict";function routerConfig($stateProvider,$urlRouterProvider){$stateProvider.state("public",{url:"/",templateUrl:"app/public/public.html"}).state("tenant",{url:"/:id",templateUrl:"app/home/home.html",controller:"HomeController",controllerAs:"home",abstract:!0,params:{id:void 0}}),$urlRouterProvider.otherwise("/")}angular.module("prokorm").config(routerConfig)}(),function(){return angular.module("prokorm").constant("version","0.0.48")}(),function(){"use strict";function runBlock($rootScope){$rootScope._=window._}angular.module("prokorm").run(runBlock)}(),function(){"use strict";function AdminController($scope,adminFactory){var vm=this;adminFactory.getTenants().then(function(tenants){vm.tenants=tenants})}angular.module("admin").controller("AdminController",AdminController)}(),angular.module("admin").factory("adminFactory",["$http","$location",function($http,$location){var host="",urlBase=host+"/api/",adminFactory={};return adminFactory.getTenants=function(){return $http.get(urlBase+"tenants")},adminFactory}]),function(){"use strict";function routerConfig($stateProvider,$urlRouterProvider){$stateProvider.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminController",controllerAs:"admin",data:{module:"admin"}})}angular.module("admin").config(routerConfig)}(),angular.module("auth").factory("authFactory",["$http","$location",function($http,$location){var host="",urlBase=host+"/api/",authFactory={};return authFactory.logout=function(){return $http.post(urlBase+"logout/")},authFactory.login=function(user){return $http.post(urlBase+"signin/",user)},authFactory.registration=function(user){return $http.post(urlBase+"registration/",user)},authFactory.getSessionData=function(){return $http.get(urlBase+"sessionData/")},authFactory.getProfileView=function(){return $http.get(urlBase+"profile/view")},authFactory.getProfileEdit=function(){return $http.get(urlBase+"profile/edit")},authFactory.updateProfile=function(profile){return $http.put(urlBase+"profile",profile)},authFactory.addUser=function(user){return $http.post(urlBase+"users",user)},authFactory.setPassword=function(pass){return $http.post(urlBase+"profile/password",pass)},authFactory}]),function(){"use strict";function routerConfig($stateProvider,$urlRouterProvider){$stateProvider.state("registration",{url:"/registration",templateUrl:"app/auth/registration/registration.html",controller:"RegistrationController",controllerAs:"registration"}).state("login",{url:"/login",templateUrl:"app/auth/login/login.html",controller:"LoginController",controllerAs:"login"}).state("login.tenant",{url:"/:tenant",templateUrl:"app/auth/login/login.html",controller:"LoginController",controllerAs:"login",params:{tenant:void 0}})}angular.module("auth").config(routerConfig)}(),function(){"use strict";function LoginController($http,$state,authFactory){var vm=this;vm.tenantName=$state.params.tenant,vm.user={tenantname:vm.tenantName||"",username:"",password:""},vm.do=function(){authFactory.login(vm.user).then(function(response){$state.go("tenant.feed",{id:response.tenantName})},function(err){vm.info=err.message})},vm.goToRegistration=function(){}}angular.module("auth").controller("LoginController",LoginController)}(),function(){"use strict";function RegistrationController($http,authFactory){var vm=this;vm.user={loginname:"",email:""},vm.do=function(){vm.error="",authFactory.registration(vm.user).then(function(response){response&&response.message&&(vm.successMessage=response.message)})},vm.goToRegistration=function(){}}angular.module("auth").controller("RegistrationController",RegistrationController)}(),angular.module("catalog").factory("catalogFactory",["$http","$location",function($http,$location){var host="",urlBase=host+"/api/",catalogFactory={};return catalogFactory.getCatalog=function(){return $http.get(urlBase+"catalog")},catalogFactory.getCatalogContentByKey=function(key){return $http.get(urlBase+"catalog/"+key)},catalogFactory.saveCatalogContentByKey=function(catalog){return $http.put(urlBase+"catalog/"+catalog.key,catalog)},catalogFactory}]),function(){"use strict";function routerConfig($stateProvider,$urlRouterProvider){$stateProvider.state("tenant.catalog",{url:"/catalog",templateUrl:"app/catalog/list/catalog.html",controller:"CatalogController",controllerAs:"catalog",data:{module:"catalog"}}).state("tenant.catalog.edit",{url:"/:terms/edit",templateUrl:"app/catalog/contentEdit/catalogContentEdit.html",controller:"CatalogContentEditController",controllerAs:"catalogContentEdit",params:{terms:void 0},data:{module:"catalog"}}).state("tenant.catalog.instance",{url:"/:terms",templateUrl:"app/catalog/content/catalogContent.html",controller:"CatalogContentController",controllerAs:"catalogContent",params:{terms:void 0},data:{module:"catalog"}})}angular.module("catalog").config(routerConfig)}(),function(){"use strict";function CatalogContentController($state,catalogFactory){var vm=this;vm.edit=function(){$state.go("tenant.catalog.edit",{terms:$state.params.terms})},$state.params.terms&&catalogFactory.getCatalogContentByKey($state.params.terms).then(function(catalogItem){vm.catalogItem=catalogItem})}angular.module("catalog").controller("CatalogContentController",CatalogContentController)}(),function(){"use strict";function CatalogContentEditController($state,catalogFactory){var vm=this;vm.save=function(){catalogFactory.saveCatalogContentByKey(vm.catalogItem).then(function(catalogItem){$state.go("tenant.catalog.instance",{terms:$state.params.terms})})},$state.params.terms&&catalogFactory.getCatalogContentByKey($state.params.terms).then(function(catalogItem){vm.catalogItem=catalogItem})}angular.module("catalog").controller("CatalogContentEditController",CatalogContentEditController)}(),function(){"use strict";function CatalogController($state,catalogFactory){var vm=this;vm.currentKey=$state.params.terms,catalogFactory.getCatalog().then(function(items){vm.catalogItems=items}),vm.onItemClick=function(catalogItem){vm.currentKey=catalogItem.key,$state.go("tenant.catalog.instance",{terms:catalogItem.key})}}angular.module("catalog").controller("CatalogController",CatalogController)}(),function(){"use strict";function AverageController($scope,feedFactory,$stateParams,_){function updateAverageRows(feedsForAverage){return feedsForAverage.length?void feedFactory.averageFeeds(feedsForAverage).then(function(result){vm.dryRawValues=result.dryRawValues,vm.headers=result.headers,vm.analysisRows=result.analysis,vm.averageRows=result.average}):(vm.averageRows=[],void(vm.headers=[]))}var vm=this;vm.propertiesForDiff=[],vm._=_;$stateParams.feeds;$scope.$on("$stateChangeSuccess",function(event,newState,params,oldState){"tenant.feed.average"===newState.name&&updateAverageRows(_.filter(params.feeds.split(":"),Boolean))})}angular.module("feed").controller("AverageController",AverageController)}(),function(){"use strict";function ChartsController($scope,feedFactory,$stateParams,_){function updateCharts(){vm.feeds&&vm.feeds.length&&feedFactory.chartsFeeds(vm.feeds).then(function(data){Highcharts.chart("container",{legend:{itemStyle:{fontWeight:"500"},itemDistance:40,itemMarginBottom:10},chart:{type:"spline"},title:!1,plotOptions:{spline:{lineWidth:4,states:{hover:{lineWidth:5}},marker:{enabled:!1}}},xAxis:{categories:data.categories},yAxis:{title:!1},series:data.chartSeries})})}var vm=this;$scope.$on("$stateChangeSuccess",function(event,newState,params,oldState){"tenant.feed.charts"===newState.name&&(vm.feeds=_.filter(params.feeds.split(":"),Boolean),updateCharts())})}angular.module("feed").controller("ChartsController",ChartsController)}(),function(){function groupButtons(){var directive={restrict:"E",templateUrl:"app/feed/controls/groupButtons/groupButtons.html",scope:{items:"=",allowAdd:"=",onAdd:"&",onDelete:"&",onSelect:"&"},replace:!0,controller:GroupButtonsController,controllerAs:"groupButtons",bindToController:!0};return directive}function GroupButtonsController($scope){var self=this;$scope.items=self.items,$scope.$watchCollection("items.length",function(){console.log(self.items.length),self.selected=_.last(self.items),self.onSelect({item:self.selected})},!0),self.onClick=function(item){console.log(self.items.length),self.selected=item,self.onSelect({item:self.selected})}}angular.module("feed").directive("groupButtons",groupButtons)}(),function(){"use strict";function DiffController($scope,feedFactory,$stateParams,_){function updateDiffRows(feedsForDiff){return feedsForDiff.length?void feedFactory.diffFeeds(feedsForDiff).then(function(result){vm.dryRawValues=result.dryRawValues,vm.headers=result.headers,vm.diffRows=result.diffs}):(vm.diffRows=[],void(vm.headers=[]))}var vm=this;vm._=_;$stateParams.feeds;$scope.$on("$stateChangeSuccess",function(event,newState,params,oldState){"tenant.feed.diff"===newState.name&&updateDiffRows(_.filter(params.feeds.split(":"),Boolean))})}angular.module("feed").controller("DiffController",DiffController)}(),function(){"use strict";function FeedEdiController($window,$stateParams,$state,$scope,feedFactory){var vm=this;vm.feedItem={analysis:[]},vm.feedTypes=[{value:"none",name:"Нет"},{value:"haylage",name:"Сенаж"},{value:"silage",name:"Силос"},{value:"grain",name:"Зерно"},{value:"cornSilage",name:"Силосованное зерно"},{value:"straw",name:"Солома"},{value:"hay",name:"Сено"},{value:"oilcake",name:"Жмых"},{value:"meal",name:"Шрот"},{value:"greenWeight",name:"Зеленая масса"},{value:"tmr",name:"TMR"}],vm.feedItemControls=[];var feedId=$stateParams.feedId,promise=feedId?feedFactory.getFeedEdit(feedId):feedFactory.getEmptyFeed();promise.then(function(feed){vm.feedItemSections=feed,vm.feedItem.analysis=_.map(feed[0].subSections,function(subSection){return subSection.initialItem})}),vm.deleteCurrentAnalysis=function(){vm.feedItemSections[0].subSections=_.filter(vm.feedItemSections[0].subSections,function(sebSection){return sebSection.initialItem!==vm.currentAnalysis}),vm.feedItem.analysis=_.map(vm.feedItemSections[0].subSections,function(subSection){return subSection.initialItem})},vm.onAnalysisAdd=function(){feedFactory.getEmptyAnalysis().then(function(newAnalysis){if(vm.feedItem.analysis&&vm.feedItem.analysis.length){var max=_.maxBy(vm.feedItem.analysis,"number");newAnalysis.initialItem.number=max.number+1,vm.feedItem.analysis.push(newAnalysis)}vm.feedItemSections[0].subSections.push(newAnalysis),vm.feedItem.analysis=_.map(vm.feedItemSections[0].subSections,function(subSection){return subSection.initialItem})})},vm.onAnalysisSelect=function(item){vm.currentAnalysis=item},vm.save=function(){var feed={analysis:_.map(vm.feedItemSections[0].subSections,function(subSection){return subSection.initialItem}),general:vm.feedItemSections[1].subSections[0].initialItem,harvest:vm.feedItemSections[2].subSections[0].initialItem,feeding:vm.feedItemSections[3].subSections[0].initialItem};feedId&&(feed._id=feedId),feedFactory.saveFeed(feed).then(function(response){"OK"===response.message&&$state.go("tenant.feed.instance",{feedId:response.id})})},vm.cancel=function(){feedId?$state.go("tenant.feed.instance",{feedId:feedId}):$state.go("tenant.feed")},vm.onSelfExplanationLinkClick=function(key){$state.go("farm.help",{key:key})}}angular.module("feed").controller("FeedEditController",FeedEdiController)}(),angular.module("feed").factory("feedFactory",["$http","$location",function($http,$location){var host="",urlBase=host+"/api/",urlBaseFeed=urlBase+"feeds/",feedFactory={};return feedFactory.getFeeds=function(){return $http.get(urlBaseFeed)},feedFactory.getFeedDashboard=function(){return $http.get(urlBaseFeed+"dashboard")},feedFactory.saveFeed=function(feed){var methode=feed._id?"put":"post",url=feed._id?urlBaseFeed+feed._id:urlBaseFeed;return $http[methode](url,feed)},feedFactory.getFeedView=function(feedId){return $http.get(urlBaseFeed+feedId+"/view")},feedFactory.getFeedEdit=function(feedId){return $http.get(urlBaseFeed+feedId+"/edit")},feedFactory.getEmptyFeed=function(){return $http.post(urlBaseFeed+"new")},feedFactory.getEmptyAnalysis=function(){return $http.post(urlBaseFeed+"newAnalysis")},feedFactory.deleteFeed=function(feedId){return $http.delete(urlBaseFeed+feedId)},feedFactory.diffFeeds=function(feedIds){return $http.post(urlBaseFeed+"diff",{feedIds:feedIds})},feedFactory.sumFeeds=function(feedIds){return $http.post(urlBaseFeed+"sum",{feedIds:feedIds})},feedFactory.averageFeeds=function(feedIds){return $http.post(urlBaseFeed+"average",{feedIds:feedIds})},feedFactory.chartsFeeds=function(feedIds){return $http.post(urlBaseFeed+"charts",{feedIds:feedIds})},feedFactory}]),function(){"use strict"}(),function(){"use strict";function routerConfig($stateProvider,$urlRouterProvider){$stateProvider.state("tenant.feed",{url:"/feed",templateUrl:"app/feed/list/feed.html",controller:"FeedController",controllerAs:"feed",data:{module:"feed"}}).state("tenant.feed.charts",{url:"/charts/:feeds",templateUrl:"app/feed/charts/charts.html",controller:"ChartsController",controllerAs:"charts",params:{feeds:void 0},data:{module:"feed"}}).state("tenant.feed.diff",{url:"/diff/:feeds",templateUrl:"app/feed/diff/diff.html",controller:"DiffController",controllerAs:"diff",params:{feeds:void 0},data:{module:"feed"}}).state("tenant.feed.sum",{url:"/sum/:feeds",templateUrl:"app/feed/sum/sum.html",controller:"SumController",controllerAs:"sum",params:{feeds:void 0},data:{module:"feed"}}).state("tenant.feed.average",{url:"/average/:feeds",templateUrl:"app/feed/average/average.html",controller:"AverageController",controllerAs:"average",params:{feeds:void 0},data:{module:"feed"}}).state("tenant.feed.new",{url:"/new",templateUrl:"app/feed/edit/feedEdit.html",controller:"FeedEditController",controllerAs:"feedEdit",data:{module:"feed"}}).state("tenant.feed.edit",{url:"/:feedId/edit",templateUrl:"app/feed/edit/feedEdit.html",controller:"FeedEditController",controllerAs:"feedEdit",params:{feedId:void 0},data:{module:"feed"}}).state("tenant.feed.instance",{url:"/:feedId",templateUrl:"app/feed/view/feedView.html",controller:"FeedViewController",controllerAs:"feedView",params:{feedId:void 0},data:{module:"feed"}})}angular.module("feed").config(routerConfig)}(),function(){"use strict";function FeedController($scope,$window,$state,feedFactory,$mdDialog){var vm=this;vm.filter={noAnalysis:!0,showEmpty:!0};var originatorEv;feedFactory.getFeeds().then(function(result){vm.filterValues=result.filterValues,vm.feedItems=result.feeds,vm.selectedItemId=$state.params.feedId,vm.updateVisible()}),feedFactory.getFeedDashboard().then(function(dashboard){vm.dashboard=dashboard}),vm.openMenu=function($mdOpenMenu,ev){originatorEv=ev,$mdOpenMenu(ev)},vm.goToHome=function(){vm.selectedItemId=null,$state.go("tenant.feed")},vm.addFeed=function(){$state.go("tenant.feed.new")},vm.diffFeed=function(){$state.go("tenant.feed.diff")},vm.averageFeed=function(){$state.go("tenant.feed.average")},vm.sumFeed=function(){$state.go("tenant.feed.sum")},vm.chartsFeed=function(){$state.go("tenant.feed.charts")},vm.isDisabled=function(feedItem){return vm.isDiffMode||vm.isAverageMode||vm.isChartMode?!Boolean(feedItem.analysis):!!vm.isSumMode&&(!Boolean(feedItem.analysis)||!Boolean(feedItem.balanceWeight))},vm.isVisible=function(feedItem){if(feedItem.isVisible=!1,vm.filter){if(!vm.filter.showEmpty&&feedItem.done)return!1;if(!vm.filter.noAnalysis&&!feedItem.analysis)return!1;if(vm.filter.years&&vm.filter.years.length&&!_.includes(vm.filter.years,feedItem.year))return!1;if(vm.filter.feedTypes&&vm.filter.feedTypes.length&&!_.includes(vm.filter.feedTypes,feedItem.feedType))return!1;if(vm.filter.compositions&&vm.filter.compositions.length&&!_.includes(vm.filter.compositions,feedItem.composition))return!1;if(vm.filter.branches&&vm.filter.branches.length&&!_.includes(vm.filter.branches,feedItem.branch))return!1;if(vm.filter.storages&&vm.filter.storages.length&&!_.includes(vm.filter.storages,feedItem.storage))return!1}return feedItem.isVisible=!0},vm.clearFilter=function(){vm.filter={noAnalysis:!0,showEmpty:!0},vm.updateVisible()},vm.toggleFilter=function(){vm.filter.visible&&($state.go(vm.lastState,{feeds:[]}),vm.updateVisible()),vm.filter.visible=!vm.filter.visible},vm.updateVisible=function(){_.forEach(vm.feedItems,function(feed){feed.isVisible=vm.isVisible(feed)}),vm.hiddenItemsLength=_.size(_.filter(vm.feedItems,{isVisible:!1}))},vm.selectAll=function(){var ids=_.map(_.filter(vm.feedItems,function(feed){return feed.isVisible&&!vm.isDisabled(feed)}),"_id");$state.go(vm.lastState,{feeds:ids.join(":")})},vm.onFeedClick=function(feedItem){if(vm.isDiffMode||vm.isAverageMode||vm.isSumMode||vm.isChartMode){var currentFeeds=_.filter($state.params.feeds.split(":"),function(o){return o}),ind=currentFeeds.indexOf(feedItem._id);ind>-1?currentFeeds.splice(ind,1):currentFeeds.push(feedItem._id),$state.go(vm.lastState,{feeds:currentFeeds.join(":")})}else vm.selectedItemId=feedItem._id,$state.go("tenant.feed.instance",{feedId:feedItem._id})},$scope.$on("stateChangeStart",function(oldState,newState){}),$scope.$on("$stateChangeSuccess",function(event,newState,params,oldState){vm.lastState=newState.name,vm.isDiffMode="tenant.feed.diff"===newState.name,vm.isAverageMode="tenant.feed.average"===newState.name,vm.isSumMode="tenant.feed.sum"===newState.name,vm.isChartMode="tenant.feed.charts"===newState.name,vm.selectedItemId=null,vm.diffFeeds=null,vm.averageFeeds=null,vm.sumFeeds=null,vm.chartFeeds=null,vm.isDiffMode?(vm.selectedItemId=null,vm.diffFeeds=params.feeds.split(":")):vm.isAverageMode?(vm.selectedItemId=null,vm.averageFeeds=params.feeds.split(":")):vm.isSumMode?(vm.selectedItemId=null,vm.sumFeeds=params.feeds.split(":")):vm.isChartMode?(vm.selectedItemId=null,vm.chartFeeds=params.feeds.split(":")):"tenant.feed"===newState.name?(vm.selectedItemId=null,feedFactory.getFeedDashboard().then(function(dashboard){vm.dashboard=dashboard})):"tenant.feed.instance"===newState.name&&(vm.selectedItemId=params.feedId),"tenant.feed.edit"===oldState.name||"tenant.feed.new"===oldState.name||"tenant.feed"===newState.name?feedFactory.getFeeds().then(function(result){vm.feedItems=result.feeds,vm.filterValues=result.filterValues,vm.updateVisible()}):vm.updateVisible()})}angular.module("feed").controller("FeedController",FeedController)}(),function(){"use strict";function SumController($scope,feedFactory,$stateParams,_){function updateSum(feedsForDiff){return feedsForDiff.length?void feedFactory.sumFeeds(feedsForDiff).then(function(result){vm.properties=result.properties,vm.sumsRows=result.sumsRows}):(vm.diffRows=[],void(vm.headers=[]))}var vm=this;vm._=_;$stateParams.feeds;$scope.$on("$stateChangeSuccess",function(event,newState,params,oldState){"tenant.feed.sum"===newState.name&&updateSum(_.filter(params.feeds.split(":"),Boolean))})}angular.module("feed").controller("SumController",SumController)}(),function(){"use strict";function FeedViewController($mdDialog,$stateParams,$state,authFactory,feedFactory,_){var vm=this;vm._=_;var feedId=$stateParams.feedId;feedId&&(vm.isDrySwitch=!0,vm.print=function(){authFactory.getSessionData().then(function(data){var analysisPrint=document.getElementById("analysis"),generalPrint=document.getElementById("general"),harvestPrint=document.getElementById("harvest"),feedingPrint=document.getElementById("feeding"),popupWin=window.open("","_blank");popupWin.document.open(),popupWin.document.write('<html style="background-color: #fff;"><title>ПРОКОРМ:печать</title><head><link rel="stylesheet" type="text/css" href="app.css"/><link rel="stylesheet" type="text/css" href="libs.css"/></head><body onload="setTimeout(function() {window.print(); window.close();}, 500)" class="feed print">'+(analysisPrint?'<div class="print-title"><h2>'+data.user.tenantFullName+'</h2><label class="key">анализы:  </label>'+vm.feed.name+"&nbsp;&nbsp;&nbsp;"+vm.feed.year+"&nbsp;&nbsp;&nbsp;"+vm.feed.storage+"</div><br/>"+analysisPrint.innerHTML+'<div class="break"></div>':"")+(generalPrint?'<div class="print-title"><h2>'+data.user.tenantFullName+'</h2><label class="key">основные:  </label>'+vm.feed.name+"   "+vm.feed.year+"</div><br/>"+generalPrint.innerHTML+"<br/>":"")+(harvestPrint?'<div class="print-title"><h2>'+data.user.tenantFullName+'</h2><label class="key">заготовка:  </label>'+vm.feed.name+"   "+vm.feed.year+"</div><br/>"+harvestPrint.innerHTML+"<br/>":"")+(feedingPrint?'<div class="print-title"><h2>'+data.user.tenantFullName+'</h2><label class="key">кормление:  </label>'+vm.feed.name+"   "+vm.feed.year+"</div><br/>"+feedingPrint.innerHTML:"")+"</body><footer>prokorm.com</footer></html>"),popupWin.document.close()})},vm.edit=function(){$state.go("tenant.feed.edit",{feedId:feedId})},vm.delete=function(ev){var confirm=$mdDialog.confirm().title("Удаление").textContent("Вы хотите удалить корм "+vm.feed.name+" ?").targetEvent(ev).ok("Да").cancel("Отменить");$mdDialog.show(confirm).then(function(){feedFactory.deleteFeed($stateParams.feedId).then(function(res){$state.go("tenant.feed")})},function(){})},feedFactory.getFeedView(feedId).then(function(feedView){vm.feed=feedView.general,vm.feedItemSections=feedView.feedItemSections,vm.actions=feedView.actions}))}FeedViewController.$inject=["$mdDialog","$stateParams","$state","authFactory","feedFactory","_"],angular.module("feed").controller("FeedViewController",FeedViewController)}(),function(){"use strict";function HelpController($scope,$state){}angular.module("help").controller("HelpController",HelpController)}(),function(){"use strict";function routerConfig($stateProvider,$urlRouterProvider){$stateProvider.state("tenant.help",{url:"/help",templateUrl:"app/help/help.html",controller:"HelpController",controllerAs:"help",data:{module:"help"}})}angular.module("help").config(routerConfig)}(),function(){"use strict";function HomeController($scope,$state,authFactory,$mdDialog){var originatorEv,vm=this;vm.currentModule="",authFactory.getSessionData().then(function(data){vm.sessionData=data}),vm.openMenu=function($mdOpenMenu,ev){originatorEv=ev,$mdOpenMenu(ev)},vm.goToModule=function(module){$state.go("tenant."+module)},vm.logout=function(){authFactory.logout()},vm.profile=function(){$state.go("tenant.profile.view")},vm.help=function(){$state.go("tenant.help")},vm.info=function(){$state.go("tenant.info")},$scope.$on("$stateChangeSuccess",function(event,newState,params,oldState){vm.currentModule=newState.data&&newState.data.module})}angular.module("prokorm").controller("HomeController",HomeController)}(),function(){"use strict";function InfoController($scope,$state,version){var vm=this;vm.version=version}angular.module("info").controller("InfoController",InfoController)}(),function(){"use strict";function routerConfig($stateProvider,$urlRouterProvider){$stateProvider.state("tenant.info",{url:"/info",templateUrl:"app/info/info.html",controller:"InfoController",controllerAs:"info",data:{module:"info"}})}angular.module("info").config(routerConfig)}(),function(){"use strict";function LoginController($http,$state,authFactory){var vm=this;vm.tenantName=$state.params.tenant,vm.user={tenantname:vm.tenantName||"",username:"",password:""},vm.do=function(){authFactory.login(vm.user).then(function(response){$state.go("tenant.feed",{id:response.tenantName})},function(err){vm.info=err.message})},vm.goToRegistration=function(){}}angular.module("prokorm").controller("LoginController",LoginController)}(),function(){"use strict";function RegistrationController($http,authFactory){var vm=this;vm.user={loginname:"",email:""},vm.do=function(){vm.error="",authFactory.registration(vm.user).then(function(response){response&&response.message&&(vm.successMessage=response.message)},function(err){vm.error=err.message})},vm.goToRegistration=function(){}}angular.module("prokorm").controller("RegistrationController",RegistrationController)}(),function(){"use strict";function ProfileViewController($scope,$state,$mdDialog,authFactory){var vm=this;authFactory.getProfileView().then(function(result){vm.userInfo=result.controls,vm.companyUsers=result.companyUsers}),vm.edit=function(){$state.go("tenant.profile.edit")},vm.changePassword=function(ev){$mdDialog.show({controller:ChangePasswordController,templateUrl:"./app/profile/changePassword.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$state.go("tenant.profile.view")},function(){$state.go("tenant.profile.view")})},vm.addUser=function(){$state.go("tenant.profile.addUser")}}function ProfileEditController($scope,$state,authFactory){var vm=this;authFactory.getProfileEdit().then(function(result){vm.userInfo=result.controls,vm.profile=result.profile}),vm.save=function(){authFactory.updateProfile(vm.profile).then(function(result){"OK"===result.message&&$state.go("tenant.profile.view")})},vm.cancel=function(){$state.go("tenant.profile.view")}}function AddUserController($scope,$state,authFactory){var vm=this;vm.user={name:"",fullName:"",email:"",password:"",tenantFullName:""},vm.cancel=function(){$state.go("tenant.profile.view")},vm.save2=function(){if(vm.user.password===vm.password_2){var permissions=[];vm.allowRead&&permissions.push("read"),vm.allowWrite&&permissions.push("write");var user=_.extend(vm.user,{permissions:permissions});authFactory.addUser(user).then(function(result){"OK"===result.message&&$state.go("tenant.profile.view")})}}}function ChangePasswordController($scope,$mdDialog,authFactory){$scope.currentPassword="",$scope.newPassword="",$scope.newPassword2="",$scope.cancel=function(){$mdDialog.cancel()},$scope.save=function(){authFactory.setPassword({currentPassword:$scope.currentPassword,newPassword:$scope.newPassword,newPassword2:$scope.newPassword2}).then(function(data){"OK"===data.message&&$state.go("tenant.profile.view")})}}angular.module("prokorm").controller("ProfileViewController",ProfileViewController),angular.module("prokorm").controller("ProfileEditController",ProfileEditController),angular.module("prokorm").controller("AddUserController",AddUserController),angular.module("prokorm").controller("ChangePasswordController",ChangePasswordController)}(),function(){"use strict";function routerConfig($stateProvider,$urlRouterProvider){$stateProvider.state("tenant.profile",{url:"/profile",templateUrl:"app/profile/profileRoot/profile.html",abstract:!0}).state("tenant.profile.view",{url:"/view",templateUrl:"app/profile/profileView/profileView.html",controller:"ProfileViewController",controllerAs:"profileView",data:{module:"profile"}}).state("tenant.profile.addUser",{url:"/addUser",templateUrl:"app/profile/addUser/addUser.html",controller:"AddUserController",controllerAs:"addUser",data:{module:"profile"}}).state("tenant.profile.edit",{url:"/edit",templateUrl:"app/profile/profileEdit/profileEdit.html",controller:"ProfileEditController",controllerAs:"profileEdit",data:{module:"profile"}})}angular.module("profile").config(routerConfig)}(),function(){"use strict";function ProfileViewController($scope,$state,$mdDialog,authFactory){var vm=this;authFactory.getProfileView().then(function(result){vm.userInfo=result.controls,vm.companyUsers=result.companyUsers}),vm.edit=function(){$state.go("tenant.profile.edit")},vm.changePassword=function(ev){$mdDialog.show({controller:ChangePasswordController,templateUrl:"./app/profile/changePassword/changePassword.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!1}).then(function(answer){$state.go("tenant.profile.view")},function(){$state.go("tenant.profile.view")})},vm.addUser=function(){$state.go("tenant.profile.addUser")}}function ProfileEditController($scope,$state,authFactory){var vm=this;authFactory.getProfileEdit().then(function(result){vm.userInfo=result.controls,vm.profile=result.profile}),vm.save=function(){authFactory.updateProfile(vm.profile).then(function(result){"OK"===result.message&&$state.go("tenant.profile.view")})},vm.cancel=function(){$state.go("tenant.profile.view")}}function AddUserController($scope,$state,authFactory){var vm=this;vm.user={name:"",fullName:"",email:"",password:"",tenantFullName:""},vm.cancel=function(){$state.go("tenant.profile.view")},vm.save2=function(){if(vm.user.password===vm.password_2){var permissions=[];vm.allowRead&&permissions.push("read"),vm.allowWrite&&permissions.push("write");var user=_.extend(vm.user,{permissions:permissions});authFactory.addUser(user).then(function(result){"OK"===result.message&&$state.go("tenant.profile.view")})}}}function ChangePasswordController($scope,$mdDialog,authFactory){$scope.currentPassword="",$scope.newPassword="",$scope.newPassword2="",$scope.cancel=function(){$mdDialog.cancel()},$scope.save=function(){authFactory.setPassword({currentPassword:$scope.currentPassword,newPassword:$scope.newPassword,newPassword2:$scope.newPassword2}).then(function(data){"OK"===data.message&&$state.go("tenant.profile.view")})}}angular.module("profile").controller("ProfileViewController",ProfileViewController),angular.module("profile").controller("ProfileEditController",ProfileEditController),angular.module("profile").controller("AddUserController",AddUserController),angular.module("profile").controller("ChangePasswordController",ChangePasswordController)}(),function(){"use strict";function SettingsController($scope,$state){}angular.module("prokorm").controller("SettingsController",SettingsController)}();